<%- include('partials/header') %>
<link rel="stylesheet" href="css/search.css">
</head>

<body>
<div id="preloader">
    <div class="rotate">
        <img src="css/svgs/basketball.svg" id="loading-svg" alt="icon">
    </div>
</div>    
<header>
    <div class="navbar">
        
        <form action="/watched" method="get">
            <button>Watched</button>
        </form>
        <form action="/watch_later" method="get">
            <button>Watch Later</button>
        </form>
        <form action="/search" method="post">
            <input type="search" id="search" name="search" placeholder="Search Movie" required>
            <input type="submit" value="Search" >
        </form>       
    </div>
</header>
<% if(locals.movies){ %>
    <div class="grid-class">
    <% movies.forEach(movie=>{ %>
        <div class="movie-container">
            <img height="300px" width="227px" src="https://image.tmdb.org/t/p/w500/<%= movie.poster%>">
            <h3><%= movie.movie_name %></h3>
            <!--action="/put_watched" method="post"-->
            <form id="choice_remove"class="choice_remove" >
                <input type="hidden" name="name" value="<%= movie.movie_name %>">
                <button  class="input">Remove</button>
            </form>
        </div>
        
    <% }) %>
    </div>
<% }else{ %>
    <center><div class="grid-class">
        <h1>OOPS! Nothing to Show HERE!</h1>
    </div></center>
<% } %>




<script>
    //for watched
    const forms = document.querySelectorAll(".movie-container");
    forms.forEach(form => {
        form.querySelector(".choice_remove").addEventListener("submit", async (e) => {
            e.preventDefault();
            //disable button
            form.querySelector(".choice_remove").querySelector(".input").disabled = true;

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch("/remove_watched", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                });
                const res = await response.json();
                if (res.status==="done") {
                    form.remove();
                    alert("Removed From Watched!");
                } else if(res.status==="bad_error"){
                    form.querySelector(".choice_remove").querySelector(".input").disabled = false;
                    alert("Something Went Really Wrong!");
                }else{
                    
                }
            } catch (err) {
                form.querySelector(".choice_remove").querySelector(".input").disabled = false;
                alert("Something Went Wrong!");
                console.error(err);
            }
        });
    });
  //for watch_later
    

  //something
  

</script>


<%- include('partials/footer') %>